# 页面对象（Page Object）说明

## 概述

本项目使用 **Page Object Model (POM)** 设计模式来组织测试代码。这种模式将页面元素和操作封装在独立的类中，使测试代码更加清晰、可维护。

## 目录结构

```
pages/
├── base_page.py      # 基础页面类（所有页面对象的基类）
├── desktop_page.py    # 桌面页面类（处理桌面相关操作）
└── login_page.py     # 登录页面类（处理登录相关操作）
```

## 核心类说明

### 1. BasePage（基础页面类）

**文件位置**: `pages/base_page.py`

**作用**: 
- 所有页面对象的基类
- 提供通用的页面操作方法
- 封装了与 `WebUIDriver` 的交互

**主要功能**:
- `page` 属性：获取 Playwright Page 对象
- `wait_for_load()`: 等待页面加载完成（子类可重写）
- `take_screenshot()`: 截图（使用统一的截图工具）
- `take_error_screenshot()`: 在发生错误时截图
- `take_success_screenshot()`: 在特定步骤成功时截图
- `is_element_visible()`: 检查元素是否可见

**使用示例**:
```python
from pages.base_page import BasePage
from core.web_ui_driver import WebUIDriver

class MyPage(BasePage):
    def __init__(self, driver: WebUIDriver):
        super().__init__(driver)
    
    async def do_something(self):
        # 使用 self.page 访问 Playwright Page 对象
        await self.page.click("button")
        
        # 使用截图功能
        await self.take_success_screenshot("操作完成")
```

### 2. DesktopPage（桌面页面类）

**文件位置**: `pages/desktop_page.py`

**作用**:
- 处理 Web 桌面相关操作
- 封装了点击应用图标、关闭弹窗等桌面操作

**主要功能**:
- `open_desktop()`: 打开桌面页面
- `wait_for_load()`: 等待桌面加载完成
- `click_app_icon()`: 点击应用图标（支持双击）
- `close_all_apps()`: 关闭所有打开的应用弹窗
- `get_app_icon_count()`: 获取桌面图标数量

**使用示例**:
```python
from pages.desktop_page import DesktopPage

# 在测试用例中使用
async def test_example(desktop: DesktopPage):
    # 双击应用图标
    await desktop.click_app_icon("实验实践教学平台", double_click=True)
    
    # 等待应用打开
    await asyncio.sleep(2)
```

**配置**:
桌面页面的配置在 `config/module_config.yaml` 中：
```yaml
desktop:
  base_url: http://10.70.70.96/Shenyuan_9#/index
  icon_selector: .desktop-icon
  wait_timeout: 5000
```

### 3. LoginPage（登录页面类）

**文件位置**: `pages/login_page.py`

**作用**:
- 处理登录相关操作
- 封装了登录流程、登录状态检查等功能

**主要功能**:
- `login()`: 执行完整登录流程
- `is_logged_in()`: 检查是否已登录
- `open_login_page()`: 打开登录页面

**使用示例**:
```python
from pages.login_page import LoginPage

# 在 fixture 中使用（已在 conftest.py 中配置）
async def test_example(login: LoginPage):
    # login fixture 已自动处理登录
    # 可以直接使用已登录的页面
    pass
```

## 设计原则

1. **单一职责**: 每个页面类只负责一个页面的操作
2. **继承复用**: 所有页面类继承自 `BasePage`，复用通用功能
3. **封装细节**: 将页面操作的细节封装在页面类中，测试用例只需调用方法
4. **易于维护**: 当页面元素变化时，只需修改对应的页面类

## 何时需要创建新的页面类？

如果测试涉及新的页面或功能模块，可以考虑创建新的页面类：

1. **应用页面类**（如 `TeachingApp`, `ExamApp`）：
   - 如果某个应用有大量复杂的操作
   - 需要封装应用内的导航、操作等

2. **通用组件类**（如 `Modal`, `Dialog`）：
   - 如果有多个页面共用的组件
   - 需要封装组件的通用操作

**注意**: 目前项目已删除了 `teaching_app.py`、`exam_app.py`、`exercise_app.py`，因为测试用例可以直接使用 Playwright API，不需要额外的封装层。

## 最佳实践

1. **优先使用 Playwright API**: 对于简单的操作，直接在测试用例中使用 `page.get_by_text()` 等方法
2. **封装复杂操作**: 对于需要多个步骤的操作，封装在页面类中
3. **使用截图功能**: 在关键步骤或错误时使用截图功能，便于调试
4. **保持简洁**: 不要过度封装，保持代码简洁易读

## 相关文件

- `core/web_ui_driver.py`: WebUI 驱动类，封装 Playwright 操作
- `test_cases/conftest.py`: Pytest fixtures，提供 `driver`、`login`、`desktop` 等
- `utils/screenshot_utils.py`: 统一的截图工具

