# 网络访问说明

## 📍 启动后显示的地址是什么意思？

当你运行 `python run.py` 后，会看到类似这样的输出：

```
NiceGUI ready to go on http://localhost:8080, http://169.254.126.204:8080, http://169.254.43.26:8080, http://172.16.20.161:8080, http://192.168.1.74:8080
```

这些地址的含义：

### 1. `http://localhost:8080` 或 `http://127.0.0.1:8080`
- **用途**：只能在本机访问
- **适用场景**：你自己访问时使用
- **特点**：最快、最稳定

### 2. `http://169.254.x.x:8080`（多个）
- **含义**：Windows 自动配置的链路本地地址（APIPA）
- **用途**：当网络没有 DHCP 服务器时自动分配
- **特点**：通常**不能用于局域网访问**，可以忽略

### 3. `http://172.x.x.x:8080`
- **含义**：可能是虚拟网络接口（如 VMware、VirtualBox、Docker）
- **用途**：虚拟机的网络接口
- **特点**：如果别人在虚拟机上，可以用这个地址

### 4. `http://192.168.x.x:8080` ⭐ **重要**
- **含义**：**局域网 IP 地址**
- **用途**：**这是别人访问你的服务应该使用的地址**
- **特点**：同一局域网内的其他设备可以通过这个地址访问

## 🔧 为什么别人无法访问？

### 常见原因

1. **Windows 防火墙阻止了端口 8080**（最常见）
2. **使用了错误的 IP 地址**（应该用 `192.168.x.x`，而不是 `169.254.x.x`）
3. **不在同一网络**（不在同一个 WiFi 或局域网）

## ✅ 解决方案

### 方法1：配置 Windows 防火墙（推荐）

#### 步骤1：打开防火墙设置
1. 按 `Win + R`，输入 `wf.msc`，回车
2. 或者：控制面板 → Windows Defender 防火墙 → 高级设置

#### 步骤2：添加入站规则
1. 点击左侧"入站规则"
2. 点击右侧"新建规则..."
3. 选择"端口"，点击"下一步"
4. 选择"TCP"，输入端口 `8080`，点击"下一步"
5. 选择"允许连接"，点击"下一步"
6. 勾选所有（域、专用、公用），点击"下一步"
7. 输入名称：`WebUI 服务端口 8080`，点击"完成"

#### 步骤3：验证
- 重启服务：`python run.py`
- 让别人访问：`http://你的局域网IP:8080`（例如：`http://192.168.1.74:8080`）

### 方法2：使用 PowerShell 快速添加防火墙规则（推荐）

以**管理员身份**打开 PowerShell，运行：

```powershell
New-NetFirewallRule -DisplayName "WebUI 服务端口 8080" -Direction Inbound -LocalPort 8080 -Protocol TCP -Action Allow
```

### 方法3：临时关闭防火墙（不推荐，仅用于测试）

⚠️ **注意**：这会降低安全性，仅用于快速测试

1. 控制面板 → Windows Defender 防火墙
2. 点击"启用或关闭 Windows Defender 防火墙"
3. 临时关闭"专用网络设置"的防火墙
4. 测试完成后，记得重新开启

## 📝 如何找到正确的局域网 IP？

### 方法1：查看启动信息
启动服务后，找到 `192.168.x.x` 开头的地址，那就是你的局域网 IP。

### 方法2：使用命令
打开命令提示符（CMD）或 PowerShell，运行：

```bash
ipconfig
```

找到"IPv4 地址"，例如：
```
IPv4 地址 . . . . . . . . . . . . : 192.168.1.74
```

### 方法3：在 Web 界面显示
可以在 Web 界面顶部显示当前可访问的地址（需要修改代码）。

## 🎯 访问示例

假设你的局域网 IP 是 `192.168.1.74`：

- **你自己访问**：`http://localhost:8080` 或 `http://127.0.0.1:8080`
- **别人访问**：`http://192.168.1.74:8080`

## ⚠️ 注意事项

1. **确保在同一网络**：访问者和服务器必须在同一个 WiFi 或局域网内
2. **防火墙规则**：必须允许端口 8080 的入站连接
3. **IP 地址变化**：如果使用 DHCP，IP 地址可能会变化，建议使用固定 IP 或每次启动后告知访问者
4. **安全考虑**：开放端口后，局域网内的任何人都可以访问，注意数据安全

## 🔍 故障排查

### 问题1：添加防火墙规则后仍然无法访问

**检查项**：
1. 确认使用的是 `192.168.x.x` 地址，不是 `169.254.x.x`
2. 确认访问者和服务器在同一网络
3. 确认服务正在运行（检查终端输出）
4. 尝试在服务器本机用局域网 IP 访问测试

### 问题2：IP 地址经常变化

**解决方案**：
1. 在路由器中为你的设备设置静态 IP（固定 IP）
2. 或者每次启动后，将正确的 IP 地址告知访问者

### 问题3：想限制访问范围

**解决方案**：
1. 在防火墙规则中，可以设置"作用域"，限制只允许特定 IP 段访问
2. 或者使用 VPN，只允许 VPN 用户访问

## 📚 相关配置

配置文件：`config/settings.yaml`

```yaml
web_ui:
  host: 0.0.0.0  # 0.0.0.0 表示监听所有网络接口
  port: 8080     # 端口号
  title: WebUI自动化测试控制台
```

- `host: 0.0.0.0`：允许所有网络接口访问（推荐）
- `host: 127.0.0.1`：只允许本机访问
- `host: 192.168.1.74`：只监听特定 IP

## 💡 提示

- 如果只是自己使用，用 `localhost:8080` 即可
- 如果需要别人访问，必须配置防火墙，并使用 `192.168.x.x` 地址
- 启动后显示的多个地址中，**只有 `192.168.x.x` 开头的地址可以用于局域网访问**

