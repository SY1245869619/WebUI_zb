# 测试报告功能说明

## 📊 功能概述

自动化测试完成后，系统会自动生成**离线HTML测试报告**，并可以通过钉钉和邮件发送。

## 🎯 报告生成

### 自动生成

每次执行测试时，系统会自动：

1. **生成HTML报告**：在 `reports/` 目录下生成带时间戳的报告文件
   - 文件名格式：`report_YYYYMMDD_HHMMSS.html`
   - 例如：`report_20240119_143022.html`

2. **解析测试结果**：从pytest输出和HTML报告中提取：
   - 总用例数
   - 通过/失败/跳过数量
   - 执行时长
   - 失败用例详情

3. **发送通知**：
   - **钉钉**：发送测试统计摘要和报告文件路径
   - **邮件**：发送HTML格式的详细报告，并**附加HTML报告文件**

## 📁 报告存储位置

所有测试报告保存在项目根目录的 `reports/` 文件夹中：

```
WebUI_zb/
├── reports/
│   ├── report_20240119_143022.html
│   ├── report_20240119_150315.html
│   └── ...
```

## 📧 邮件报告

### HTML格式邮件

邮件内容包含：

- **测试统计卡片**：总用例数、通过、失败、跳过（带颜色区分）
- **通过率**：以百分比显示，颜色根据通过率变化
- **失败用例详情**：包含用例名称和错误信息
- **HTML报告附件**：完整的pytest-html报告文件

### 查看报告

1. **在邮件中查看**：直接打开邮件，查看HTML格式的统计信息
2. **下载附件**：下载HTML报告文件，在浏览器中打开查看完整详情
3. **本地查看**：在 `reports/` 目录中找到对应的报告文件

## 💬 钉钉报告

钉钉消息包含：

- **测试统计摘要**：总用例数、通过、失败、跳过
- **执行时长和通过率**
- **失败用例列表**（前5个）
- **报告文件路径**：提示查看详细报告的位置

## 🔧 配置要求

### 1. 启用通知

在Web界面中配置：

- **钉钉通知**：勾选"启用钉钉通知"，配置Webhook和Secret
- **邮件通知**：勾选"启用邮件通知"，配置SMTP和收件人

### 2. 报告自动生成

无需额外配置，每次执行测试都会自动生成报告。

## 📋 报告内容

### HTML报告包含

- **测试概览**：执行时间、模块、统计信息
- **测试用例列表**：所有执行的测试用例
- **详细结果**：每个用例的执行状态、时长、错误信息
- **截图**：失败用例的自动截图（如果配置了）

### 报告特点

- **独立文件**：使用 `--self-contained-html` 参数，报告文件包含所有资源，可以离线查看
- **时间戳命名**：每次执行生成新的报告，不会覆盖之前的报告
- **完整信息**：包含所有测试细节，便于问题排查

## 💡 使用建议

### 1. 定期清理报告

报告文件会累积，建议定期清理旧报告：

```bash
# 只保留最近10个报告
cd reports
ls -t report_*.html | tail -n +11 | xargs rm
```

### 2. 报告归档

重要测试的报告可以：

- 重命名保存：`report_20240119_143022_重要测试.html`
- 移动到归档目录：`reports/archive/`
- 上传到文件服务器或版本控制系统

### 3. 分享报告

- **邮件分享**：报告会自动附加到邮件中
- **钉钉分享**：可以在钉钉中上传报告文件
- **本地分享**：直接发送 `reports/` 目录中的HTML文件

## 🔍 报告解析逻辑

系统使用两种方式解析测试结果：

1. **pytest输出解析**：从实时输出中提取统计信息
2. **HTML报告解析**：从生成的HTML文件中提取（更准确）

优先使用HTML报告中的统计信息，确保准确性。

## ⚠️ 注意事项

1. **报告目录**：确保 `reports/` 目录有写入权限
2. **文件大小**：如果测试用例很多，报告文件可能较大，邮件发送可能需要时间
3. **报告保留**：系统不会自动删除旧报告，需要手动清理
4. **编码问题**：报告使用UTF-8编码，确保邮件客户端支持

## 📚 相关文件

- **报告解析工具**：`utils/report_parser.py`
- **通知服务**：`core/notification.py`
- **报告存储目录**：`reports/`

