# 录制时如何生成断言

## 为什么录制时看不到断言？

**重要说明**：Playwright Codegen **默认不会自动生成所有断言**。断言需要**手动触发**或通过**特定操作**才会生成。

## 如何让录制工具生成断言？

### 方法1：使用"Assert"按钮（推荐）⭐

在 Playwright Codegen 的代码窗口中，有一个 **"Assert"** 按钮：

1. **操作步骤**：
   - 在浏览器中执行操作（如点击菜单）
   - 等待页面加载完成
   - 在代码窗口中点击 **"Assert"** 按钮
   - 在浏览器中**点击或悬停**你想要验证的元素
   - 录制工具会自动生成断言代码

2. **示例**：
   ```
   操作：点击"课程库管理"菜单
   → 页面加载后，点击"Assert"按钮
   → 在浏览器中点击表格表头
   → 自动生成：await expect(page.get_by_role("row", name="...")).to_be_visible()
   ```

### 方法2：使用键盘快捷键

1. **操作步骤**：
   - 执行操作后，按 **`Ctrl+Shift+A`**（Windows）或 **`Cmd+Shift+A`**（Mac）
   - 然后在浏览器中点击要验证的元素
   - 断言会自动生成

### 方法3：手动添加断言（录制后）

如果录制时没有生成断言，可以在录制完成后手动添加：

```python
# 录制生成的代码（没有断言）
await page.get_by_role("menuitem", name="课程库管理").click()

# 手动添加断言
await expect(page.get_by_role("tabpanel", name="个人课程")).to_be_visible()
```

## 什么时候需要断言？

断言应该添加在以下场景：

1. **页面跳转后**：验证新页面是否正确加载
   ```python
   await page.get_by_role("menuitem", name="课程库管理").click()
   await expect(page.get_by_role("tabpanel", name="个人课程")).to_be_visible()  # 验证页面加载
   ```

2. **菜单展开后**：验证子菜单是否显示
   ```python
   await page.get_by_text("教学管理").click()
   await expect(page.get_by_role("menuitem", name="综合分析")).to_be_visible()  # 验证菜单展开
   ```

3. **表格加载后**：验证表格是否显示
   ```python
   await page.get_by_role("menuitem", name="自由学习管理").click()
   await expect(page.get_by_role("row", name="课程名称 课程分类...")).to_be_visible()  # 验证表格
   ```

4. **操作成功后**：验证操作结果
   ```python
   await page.get_by_role("button", name="保存").click()
   await expect(page.get_by_text("保存成功")).to_be_visible()  # 验证成功提示
   ```

## 如何识别需要断言的地方？

### 1. 观察页面变化

录制时注意观察：
- 点击后页面是否跳转？
- 菜单是否展开？
- 表格是否加载？
- 是否有成功提示？

### 2. 参考已有的测试用例

查看 `test_cases/teaching/test_teaching_basic.py` 中的 `test_teaching_navigation` 方法，学习断言的添加模式。

### 3. 使用 Playwright Inspector

使用 Playwright Inspector 可以帮助识别页面元素：
```bash
playwright codegen --target python-async http://10.70.70.96/Shenyuan_9#/index
```

## 常见断言类型

### 1. 验证元素可见
```python
await expect(page.get_by_text("教学管理")).to_be_visible()
```

### 2. 验证元素包含文本
```python
await expect(page.get_by_text("保存成功")).to_be_visible()
```

### 3. 验证表格行
```python
await expect(page.get_by_role("row", name="课程名称 课程分类 课程关键字...")).to_be_visible()
```

### 4. 验证 iframe 内容
```python
await expect(page.locator("iframe[name=\"fscr-teaching\"]").content_frame.get_by_role("menuitem", name="综合分析")).to_be_visible()
```

## 最佳实践

1. **录制时主动添加断言**：
   - 每次操作后，如果页面有明显变化，使用"Assert"按钮添加断言
   - 不要等到录制完成后再添加

2. **断言要具体**：
   - 断言应该验证**关键元素**，而不是所有元素
   - 优先验证**操作结果**，而不是中间过程

3. **断言要稳定**：
   - 选择**不会频繁变化**的元素作为断言目标
   - 避免使用动态生成的内容（如时间戳、随机ID）

4. **参考现有代码**：
   - 查看 `test_teaching_basic.py` 中的断言模式
   - 保持断言风格一致

## 总结

- **录制工具默认不会自动生成所有断言**
- **需要手动使用"Assert"按钮或快捷键触发**
- **录制后也可以手动添加断言**
- **断言应该验证关键操作的成功**

---

**提示**：如果录制时没有生成断言，不用担心！可以在录制完成后，参考 `test_teaching_basic.py` 中的模式手动添加断言。

